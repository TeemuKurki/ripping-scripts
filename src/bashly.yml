name: ripper
help: Rip DVDs and Blurays
version: 0.1.0

commands:
  - name: dvd
    args:
      - name: title
        required: true
        help: Title of the Bluray
    flags:
      - long: --show
      - long: --disk-path
        arg: disk-path
        help: Disk drive location
        default: /dev/sr0
      - long: --min-length
        arg: min-length
        help: |
          Minimum length of title for rippping
        default: "20"
      - long: --max-length
        arg: max-length
        default: "0"
        help: |
          Maximum length of title for rippping. Set to '0' to disable
      - long: --season
        arg: season
        default: "1"
        needs:
          - --show
      - long: --disk
        arg: disk
        default: "1"
      - long: --title
        short: -t
        arg: titles
        repeatable: true
        unique: true
        help: |
          Set specific titles to be ripped. Setting this will ignore --min-length and --max-length properties
      - long: --audio-track
        arg: audio-track
      - long: --subtitle-track
        arg: subtitle-track
      - long: --audio-codec
        arg: audio-codec
        default: aac
        help: Used ffmpeg audio codec. By default use aac
      - long: --verify-speed
        arg: verify-speed
        default: "16"
        help: Set verify speed multiplier. Set to 0 to disable
      - long: --exit-on-verify-error
        arg: exit-on-verify-error
        default: "false"
        help: Exit if verification fails
        allowed:
          - "false"
          - "true"
      - long: --min-output-size
        arg: min-output-size
        default: "10"
        help: Delete output files smaller than value in MB
      - long: --no-auto-meta
        help: Do not set language metadata for audio and subtitle streams
    dependencies:
      bd_utils:
        command:
          - lsdvd
        help: Run 'sudo apt install lsdvd'
      ffmpeg:
        command:
          - ffmpeg
        help: Run 'sudo apt install ffmpeg'
      mpv: Run 'sudo apt install mpv'

  - name: bluray
    args:
      - name: title
        required: true
        help: Title of the Bluray
    flags:
      - long: --show
      - long: --disk-path
        arg: disk-path
        help: Disk drive location
        default: /dev/sr0
      - long: --key
        arg: key
        default: $HOME/.config/aacs/KEYDB.cfg
        help: Location of aacs KEYDB.cfg
      - long: --min-length
        arg: min-length
        help: |
          Minimum length of title for rippping
        default: "20"
      - long: --season
        arg: season
        default: "1"
        needs:
          - --show
      - long: --disk
        arg: disk
        default: "1"
      - long: --audio-codec
        arg: audio-codec
        default: aac
        help: Used ffmpeg audio codec. By default use aac
      - long: --verify-speed
        arg: verify-speed
        default: "16"
        help: Set verify speed multiplier. Set to 0 to disable
      - long: --exit-on-verify-error
        arg: exit-on-verify-error
        default: "false"
        help: Exit if verification fails
        allowed:
          - "false"
          - "true"
    dependencies:
      bd_utils:
        command:
          - bd_list_titles
          - bd_splice
        help: Run 'sudo apt install libbluray-bin'
      ffmpeg:
        command:
          - ffmpeg
        help: Run 'sudo apt install ffmpeg'
      mpv: Run 'sudo apt install mpv'

  - name: update_track_meta
    help: Set metadata information for tracks. Eg Audio track language
    args:
      - name: target
        required: true
        help: Target file or directory. If provided directory will update all files in directory
        validate: dir_or_file_exists
      - name: track
        required: true
        help: |
          Track number (1) or one of the chars 'a', 'b', 's' or 'v' followed by a number 'n' selects the nth audio, button, subtitle or video track (s1)
    flags:
      - long: --set
        short: -s
        arg: meta
        required: true
        repeatable: true
        unique: true
    examples:
      - ripper update_track_meta ~/Videos/<show>/<season> a1 -s language=eng -s name=English
      - ripper update_track_meta ~/Videos/movie-name.mkv s1 -s language=fin -s name=Finnish -s flag-default=1
    dependencies:
      mkvtoolnix:
        command:
          - mkvpropedit
        help: Run 'sudo apt install mkvtoolnix'
